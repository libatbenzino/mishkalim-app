<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>רשימת משטחים</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    body {
      font-family: "Alef", sans-serif;
      direction: rtl;
      margin: 40px;
      background-color: #f5f5f5;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #e0e0e0;
    }

    input {
      width: 80px;
      padding: 5px;
      text-align: center;
    }

    .button {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 10px 16px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 20px;
    }

    .button:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>

  <h2>רשימת משטחים</h2>

  <table id="table">
    <thead>
      <tr>
        <th>מספר משטח</th>
        <th>חבית 1 (ק"ג)</th>
        <th>חבית 2 (ק"ג)</th>
        <th>חבית 3 (ק"ג)</th>
        <th>חבית 4 (ק"ג)</th>
        <th>סה"כ משקל (ק"ג)</th>
        <th>פעולות</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>OF458755</td>
        <td><input type="number" value="45" oninput="calculateRowTotal(this)"></td>
        <td><input type="number" value="587" oninput="calculateRowTotal(this)"></td>
        <td><input type="number" value="565" oninput="calculateRowTotal(this)"></td>
        <td><input type="number" value="487" oninput="calculateRowTotal(this)"></td>
        <td class="total">1684.0</td>
        <td><button onclick="deleteRow(this)">🗑️</button></td>
      </tr>
    </tbody>
  </table>

  <button class="button" onclick="exportPDF()">ייצא ל-PDF</button>

  <script>
    function calculateRowTotal(input) {
      const row = input.closest("tr");
      const inputs = row.querySelectorAll("input");
      let total = 0;
      inputs.forEach(i => {
        const value = parseFloat(i.value);
        if (!isNaN(value)) total += value;
      });
      row.querySelector(".total").textContent = total.toFixed(1);
    }

    function deleteRow(button) {
      const row = button.closest("tr");
      row.remove();
    }

    const { jsPDF } = window.jspdf;

    function exportPDF() {
      const doc = new jsPDF({ orientation: 'landscape', unit: 'pt' });

      // הוספת פונט Alef בעברית (מקודד Base64)
      doc.addFileToVFS("Alef-Regular.ttf", "AAEAAAASAQAABAAgR0RFRrRCsIIAAEAAAACcG..."); // קוד מקוצר, שלח לי "שלח פונט מלא" אם אתה צריך אותו
      doc.addFont("Alef-Regular.ttf", "Alef", "normal");
      doc.setFont("Alef");

      doc.setFontSize(16);
      doc.text("רשימת משטחים", 780, 40, { align: "right" });

      const rows = [];
      const tableRows = document.querySelectorAll('#table tbody tr');

      tableRows.forEach(row => {
        const palletId = row.cells[0].innerText.trim();
        const weights = Array.from(row.querySelectorAll('input')).map(i => i.value.trim());
        const total = row.querySelector('.total').innerText.trim();
        rows.push([palletId, ...weights, total]);
      });

      doc.autoTable({
        head: [['מספר משטח', 'חבית 1 (ק"ג)', 'חבית 2 (ק"ג)', 'חבית 3 (ק"ג)', 'חבית 4 (ק"ג)', 'סה"כ משקל (ק"ג)']],
        body: rows,
        startY: 60,
        styles: {
          font: "Alef",
          fontSize: 12,
          halign: "right"
        },
        headStyles: {
          fillColor: [0, 112, 60],
          textColor: 255
        },
        margin: { left: 40, right: 40 }
      });

      doc.save("רשימת_משטחים.pdf");
    }
  </script>

</body>
</html>
